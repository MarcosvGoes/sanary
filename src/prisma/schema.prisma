generator client {
    provider     = "prisma-client"
    output       = "./generated/prisma"
    moduleFormat = "cjs"
}

datasource db {
    provider = "postgresql"
}

model User {
    id             String          @id @default(uuid())
    name           String
    email          String          @unique
    emailVerified  Boolean
    image          String?
    createdAt      DateTime        @default(now())
    updatedAt      DateTime        @updatedAt
    phoneNumber    String?
    cpf            String?         @unique
    documentNumber String?
    documentType   String?
    ufEmitter      String?
    cep            String?
    street         String?
    number         String?
    complement     String?
    neighborhood   String?
    city           String?
    state          String?
    houseNumber    String?
    profession     String?
    civilStatus    String?
    stateOfBirth   String?
    cityOfBirth    String?
    birthDate      DateTime?
    accounts       Account[]
    notifications  Notifications[]
    bookings       Booking[]
    paymentData UserPaymentData? @relation("UserPaymentData")
    sessions    Session[]
}

model Notifications {
    id          String    @id @default(uuid())
    userId      String
    title       String
    description String?
    readAt      DateTime?
    createdAt   DateTime  @default(now())
    redirectUrl String?
    user        User      @relation(fields: [userId], references: [id])

    @@index([userId, createdAt])
    @@index([userId, readAt])
}

model Payments {
    id                    String           @id @default(uuid())
    paymentId             String?          @unique
    userPaymentDataId     String?
    billingType           String?
    description           String?
    invoiceUrl            String?
    transactionReceiptUrl String?
    userAmount            Float?
    amount                Float
    discount              Float?
    status                String?
    createdAt             DateTime?
    paidAt                DateTime?
    dueDate               DateTime?
    updatedAt             DateTime         @updatedAt
    invoiceId             String?          @unique
    invoiceStatus         String?
    userPaymentData       UserPaymentData? @relation(fields: [userPaymentDataId], references: [id])
}

model UserPaymentData {
    id              String     @id @default(uuid())
    userId          String     @unique
    customerId      String?    @unique
    last4DigitsCard String?
    holderName      String?
    brand           String?
    creditCardToken String?
    createdAt       DateTime   @default(now())
    updatedAt       DateTime   @updatedAt
    user            User       @relation("UserPaymentData", fields: [userId], references: [id], onDelete: Cascade)
    Payments        Payments[]
}

model Session {
    id             String   @id @default(uuid())
    expiresAt      DateTime
    token          String   @unique
    createdAt      DateTime @default(now())
    updatedAt      DateTime
    ipAddress      String?
    userAgent      String?
    userId         String
    impersonatedBy String?
    user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Account {
    id                    String    @id
    accountId             String
    providerId            String
    userId                String
    accessToken           String?
    refreshToken          String?
    idToken               String?
    accessTokenExpiresAt  DateTime?
    refreshTokenExpiresAt DateTime?
    scope                 String?
    password              String?
    createdAt             DateTime
    updatedAt             DateTime
    user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Verification {
    id         String    @id
    identifier String
    value      String
    expiresAt  DateTime
    createdAt  DateTime?
    updatedAt  DateTime?
}

model Booking {
    id String @id @default(cuid())

    userId String
    user   User   @relation(fields: [userId], references: [id])

    checkIn  DateTime
    checkOut DateTime

    notes  String?
    status BookingStatus @default(PENDING)

    guests Guest[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([userId])
}

model Guest {
    id String @id @default(cuid())

    name      String
    cpf       String
    birthDate DateTime
    type      GuestType

    booking   Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)
    bookingId String

    createdAt DateTime @default(now())
}

enum GuestType {
    adult
    elderly
    child
    baby
}

enum BookingStatus {
    PENDING
    CONFIRMED
    CANCELED
}
