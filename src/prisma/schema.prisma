generator client {
    provider     = "prisma-client"
    output       = "./generated/prisma"
    moduleFormat = "cjs"
}

datasource db {
    provider = "postgresql"
}

model User {
    id             String           @id @default(uuid())
    name           String
    email          String           @unique
    emailVerified  Boolean
    image          String?
    createdAt      DateTime         @default(now())
    updatedAt      DateTime         @updatedAt
    phoneNumber    String?
    cpf            String?          @unique
    documentNumber String?
    documentType   String?
    ufEmitter      String?
    cep            String?
    street         String?
    number         String?
    nacionality    String?
    complement     String?
    neighborhood   String?
    city           String?
    state          String?
    houseNumber    String?
    birthDate      DateTime?
    accounts       Account[]
    bookings       Booking[]
    paymentData    UserPaymentData? @relation("UserPaymentData")
    sessions       Session[]
    role           String           @default("user")
    banned         Boolean          @default(false)
    banReason      String?
    banExpires     DateTime?

    @@map("user")
}

model Payments {
    id                    String           @id @default(uuid())
    paymentId             String?          @unique
    userPaymentDataId     String?
    billingType           String?
    description           String?
    invoiceUrl            String?
    transactionReceiptUrl String?
    userAmount            Float?
    amount                Float
    discount              Float?
    status                String?
    createdAt             DateTime?
    paidAt                DateTime?
    dueDate               DateTime?
    updatedAt             DateTime         @updatedAt
    invoiceId             String?          @unique
    invoiceStatus         String?
    userPaymentData       UserPaymentData? @relation(fields: [userPaymentDataId], references: [id])

    @@map("payments")
}

model UserPaymentData {
    id              String     @id @default(uuid())
    userId          String     @unique
    customerId      String?    @unique
    last4DigitsCard String?
    holderName      String?
    brand           String?
    creditCardToken String?
    createdAt       DateTime   @default(now())
    updatedAt       DateTime   @updatedAt
    user            User       @relation("UserPaymentData", fields: [userId], references: [id], onDelete: Cascade)
    Payments        Payments[]

    @@map("userPaymentData")
}

model Booking {
    id String @id @default(cuid())

    userId String
    user   User   @relation(fields: [userId], references: [id])

    roomId String
    room   Room   @relation(fields: [roomId], references: [id])

    checkIn  DateTime
    checkOut DateTime

    notes  String?
    status BookingStatus @default(PENDING)

    guests Guest[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([userId])
    @@index([roomId])
    @@map("booking")
}

model Guest {
    id String @id @default(cuid())

    name      String
    cpf       String
    birthDate DateTime
    type      GuestType

    booking   Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)
    bookingId String

    createdAt DateTime @default(now())

    @@map("guest")
}

model Room {
    id          String  @id @default(cuid())
    title       String
    description String?

    price    Float
    capacity Int

    images RoomImage[]

    bookings Booking[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("room")
}

model Session {
    id        String   @id
    expiresAt DateTime
    token     String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    ipAddress String?
    userAgent String?
    userId    String
    user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([token])
    @@index([userId])
    @@map("session")
}

model Account {
    id                    String    @id
    accountId             String
    providerId            String
    userId                String
    user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
    accessToken           String?
    refreshToken          String?
    idToken               String?
    accessTokenExpiresAt  DateTime?
    refreshTokenExpiresAt DateTime?
    scope                 String?
    password              String?
    createdAt             DateTime  @default(now())
    updatedAt             DateTime  @updatedAt

    @@index([userId])
    @@map("account")
}

model Verification {
    id         String   @id
    identifier String
    value      String
    expiresAt  DateTime
    createdAt  DateTime @default(now())
    updatedAt  DateTime @updatedAt

    @@index([identifier])
    @@map("verification")
}

enum GuestType {
    adult
    elderly
    child
    baby
}

enum BookingStatus {
    PENDING
    CONFIRMED
    CANCELED
}

model RoomImage {
    id  String @id @default(cuid())
    url String

    roomId String
    room   Room   @relation(fields: [roomId], references: [id], onDelete: Cascade)

    @@map("room_image")
}
